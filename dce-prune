#!/usr/bin/execlineb -Ws1

dce-print { going $1 }

importas -i d d

if { rm -f ${d}/progress }

if {
  export mode $1
  forbacktickx -Eo 0 x { dce-names }
    multidefine $x { t n }
    export t $t
    export n $n
    dce-process
}

ifelse { test -e ${d}/progress }
{
  exec $0 automatic $@
}
ifelse {
  importas -i fd fd
  importas -i sd sd
  getcwd -E pwd
  cd $fd
  elglob -0 xs *
  cd $pwd
  forx -Eo 0 x { $xs }
  test -e ${sd}/${x}
}
{
  dce-print { all remaining symbols marked 'skip'. }
}
exec $@
