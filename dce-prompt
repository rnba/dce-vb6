#!/usr/bin/execlineb -Wp

importas -i 0 0

if { printf "\n[acCeqsS?] ? " }
backtick -E x { sed -E 1q }
dce-switch $x
case ? {
  if {
    printf "%s\n"
      "c: commit the proposal"
      "C: commit the proposal with a custom message"
      "e: edit files, then restart"
      "q: quit"
      "s: skip the proposal"
      "S: start an interactive shell"
      "?: this help"
  }
  exec $0
}
case a {
  exec dce-prune automatic true
}
case c {
  exec dce-commit
}
case C {
  exec dce-commit --edit
}
case e {
  importas -D vim VISUAL VISUAL
  importas -i file file
  foreground { $VISUAL $file }
  foreground {
    importas ? ?
    printf "%s exited %d\n" $VISUAL $?
  }
  exec dce-process-interactive
}
case q {
  exit 1
}
case s {
  exec git checkout -fq
}
case S {
  if { echo "starting an interactive shell.  will resume when it exits." }
  importas -i SHELL SHELL
  foreground { $SHELL -i }
  exec dce-process-interactive
}
case _ {
  exec $0
}
